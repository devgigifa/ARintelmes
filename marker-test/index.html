<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>AR Intelmes</title>
    <link rel="icon" href="https://img.icons8.com/ios_filled/200/40C057/info.png">

    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>    
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"> </script>
    
    <script src="script.js" defer></script>
    
    <style>
        #a-scene {
            display: block; 
            position: absolute;
            top: 50%;                              /* centraliza verticalmente */
            left: 50%;                             /* centraliza horizontalmente */
            transform: translate(-50%, -50%);      /* realinhamento */
            width: 600px;     
            height: 700px;    
            max-width: 100%;                       /* largura não ultrapasse 100% */
            max-height: 100%;                      /* altura não ultrapasse 100% */
        }
    </style>
</head>
 
<body>
    <a-scene
        id="a-scene"
        embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;" 
        camera="position: 0 1 0; fov: 100;"
        vr-mode-ui="enabled: false;"
    >
        <a-entity camera position="0 1 0" look-controls="enabled: false"></a-entity>

<!-- mac -->

    <a-nft type="nft" url="https://cors-anywhere.herokuapp.com/https://raw.githubusercontent.com/alssnfb/nftmarkertest/main/nft_markers/machine_1/" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5" id="machine1-marker" data-mac="DD0:EF:76:46:72:0B">
        <a-entity visible="false" position="0 0 0"></a-entity>
    </a-nft>
    
    <a-nft type="nft" url="https://cors-anywhere.herokuapp.com/https://raw.githubusercontent.com/alssnfb/nftmarkertest/main/nft_markers/machine_2/" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5" id="machine2-marker" data-mac="D0:EF:76:46:72:0B">
        <a-entity visible="false" position="0 0 0"></a-entity>
    </a-nft>
    
    <a-nft type="nft" url="https://cors-anywhere.herokuapp.com/https://raw.githubusercontent.com/alssnfb/nftmarkertest/main/nft_markers/machine_3/" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5" id="machine3-marker" data-mac="D0:EF:76:46:72:0B">
        <a-entity visible="false" position="0 0 0"></a-entity>
    </a-nft>
    
    <a-nft type="nft" url="https://cors-anywhere.herokuapp.com/https://raw.githubusercontent.com/alssnfb/nftmarkertest/main/nft_markers/machine_4/" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5" id="machine4-marker" data-mac="D0:EF:76:46:72:0B">
        <a-entity visible="false" position="0 0 0"></a-entity>
    </a-nft>

<a-entity id="entity" visible="false">
    <a-box id="grandbox" material="color: black; opacity: 1;"
        position="0 1.25 -3"
        rotation="0 0 0"
        scale="2 1 0.5"
    ></a-box>
    <a-box id="box" material="color: black; opacity: 0.35;"
        position="0 0.805 -3"
        rotation="0 0 0"
        scale="2 0.11 0.5"
    ></a-box>

    <a-text id="hours" color="white" value="" align="center"
        width="1.3"
        scale="1.2 0.7 1.2" 
        position="-0.7 1.60 -2.4" 
    ></a-text>

    <a-text id="perf" color="white" 
        width="1.3"
        scale="1 0.5 1" 
        position="0.41 1.60 -2.4"
    ></a-text>

    <a-text id="itemtool" color="white" 
        width="1.3"
        scale="1 0.5 1" 
        position="0.41 1.57 -2.4"
    ></a-text>

    <a-text id="rescode" color="white" align="center"
        width="1.3"
        scale="3 1.8 3" 
        position="0 1.50 -2.4" 
    ></a-text>

    <a-text id="status" color="white" align="center" 
        width="1.3"
        scale="2.3 1 2.3" 
        position="0 1.30 -2" 
    ></a-text>

    <!-- Barra de Produção ................................................... -->
    <a-entity position="0 1.43 -2.2" frustumCulled="false">
        <a-box id="production-bar" material="color: black; opacity: 0.35;"
            scale="0 0.1 0.1"  
            position="-0.65 -0.1 0"
        ></a-box>
    </a-entity>

    <a-text id="statusPercentage" value="" color="white" align="center" 
        width="1.3"
        scale="1.5 0.9 1.5" 
        position="0 1.25 -2.4" 
    ></a-text> 

    <a-box id="bar" material="color: black; opacity: 0.15;"
        scale="1.4 0.11 0.1"  
        position="0 1.36 -2.4"
    ></a-box>
    <!-- .................................................................... -->

    <a-entity id="lineI" line="start: -0.8 1.20 -2.4; end: 0.8 1.20 -2.4; color: white"></a-entity>

    <a-text id="tc" value="TC" color="white" 
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="-0.79 1.15 -2.4" 
    ></a-text>
    <a-text id="cycletime" color="white" align="center" 
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="-0.75 1.08 -2.4" 
    ></a-text>  

    <a-text id="op" value="OP" color="white" align="center"
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="-0.45 1.15 -2.4" 
    ></a-text>
    <a-text id="operationcode" color="white" align="center"
        width="1.3"
        scale="1 0.8 1" 
        position="-0.45 1.08 -2.4" 
    ></a-text>  

    <a-text id="qtd" value="QTD" color="white" align="center"
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="-0.15 1.15 -2.4"
    ></a-text>
    <a-text id="quantity" color="white" align="center"
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="-0.15 1.08 -2.4" 
    ></a-text>  

    <a-text id="qtdprod" value="QTD PROD" color="white" align="center" 
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="0.14 1.15 -2.4" 
    ></a-text>
    <a-text id="quantityprod" color="white" align="center" 
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="0.14 1.08 -2.4" 
    ></a-text>  

    <a-text id="ref" value="REF" color="white" align="center"
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="0.40 1.15 -2.4" 
    ></a-text>
    <a-text id="scrapquantity" color="white" align="center" 
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="0.40 1.08 -2.4" 
    ></a-text>

    <a-text id="qtdboa" value="QTD BOA" align="center"
        color="white" 
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="0.65 1.15 -2.4" 
    ></a-text>
    <a-text id="goodquantity" color="white" align="center" 
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="0.65 1.08 -2.4" 
    ></a-text>

    <a-entity id="lineII" line="start: -0.8 1.03 -2.4; end: 0.8 1.03 -2.4; color: white" frustumCulled="false"></a-entity>

    <a-text id="item" color="white" align="left" 
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="-0.8 0.95 -2.4" 
    ></a-text>

    <a-text id="nextop" color="white" align="left"
        width="1.3"
        scale="1.2 0.8 1.2" 
        position="-0.8 0.84 -2.4" 
    ></a-text> 

    <!-- GAUGES -->
    <a-entity id="gauges-group" frustumCulled="false">
        <a-entity id="gauge-OEE" 
            position="-1 0.5 -2.4"  
            scale="0.35 0.35 0.35"
        >
            <!-- Anel de fundo transparente preto -->
            <a-ring id="ring-background" material="color: black; opacity: 0.35;" radius-inner="0.35" radius-outer="0.45" theta-start="0" theta-length="360"></a-ring>
            
            <!-- Anel principal -->
            <a-ring id="ring-oee" color="blue" radius-inner="0.35" radius-outer="0.45" theta-start="0" theta-length="0"></a-ring>
            <a-text id="text-oee" value="" align="center" color="white" position="0 0.6 0" ></a-text>
        </a-entity>
    
        <a-entity id="gauge-Disponibilidade" 
            position="-0.4 0.5 -2.4"  
            scale="0.35 0.35 0.35"  
        >
            <!-- Anel de fundo transparente preto -->
            <a-ring id="ring-background" material="color: black; opacity: 0.35;" radius-inner="0.35" radius-outer="0.45" theta-start="0" theta-length="360"></a-ring>
    
            <!-- Anel principal -->
            <a-ring id="ring-available" color="orange" radius-inner="0.35" radius-outer="0.45" theta-start="0" theta-length="0" ></a-ring>
            <a-text id="text-available" value="" position="0 0.6 0" align="center" color="white"></a-text>
        </a-entity>
    
        <a-entity id="gauge-Performance" 
            position="0.3 0.5 -2.4"  
            scale="0.35 0.35 0.35"  
        >
            <!-- Anel de fundo transparente preto -->
            <a-ring id="ring-background" material="color: black; opacity: 0.35;" radius-inner="0.35" radius-outer="0.45" theta-start="0" theta-length="360"></a-ring>
    
            <!-- Anel principal -->
            <a-ring id="ring-performance" color="green" radius-inner="0.35" radius-outer="0.45" theta-start="0" theta-length="0" ></a-ring>
            <a-text id="text-performance" value="" position="0 0.6 0" align="center" color="white" ></a-text>
        </a-entity>
    
        <a-entity id="gauge-Qualidade" 
            position="1 0.5 -2.4"  
            scale="0.35 0.35 0.35"  
        >
            <!-- Anel de fundo transparente preto -->
            <a-ring id="ring-background" material="color: black; opacity: 0.35;" radius-inner="0.35" radius-outer="0.45" theta-start="0" theta-length="360"></a-ring>
    
            <!-- Anel principal -->
            <a-ring id="ring-quality" color="yellow" radius-inner="0.35" radius-outer="0.45" theta-start="0" theta-length="0"></a-ring>
            <a-text id="text-quality" value="" position="0 0.6 0" align="center" color="white"></a-text>
        </a-entity>
    </a-entity>
</a-entity>

    <script>
        // Detect when NFT markers are found
        document.querySelector('#machine1-marker').addEventListener('markerFound', async function () {
            console.log('Machine 1 NFT marker detected!');
            await fetchMachineData(); // Call your function to fetch data
        });

        document.querySelector('#machine1-marker').addEventListener('markerLost', function () {
            console.log('Machine 1 marker lost.');
        });

        document.querySelector('#machine2-marker').addEventListener('markerFound', async function () {
            console.log('Machine 2 NFT marker detected!');
            await fetchMachineData();
        });

        document.querySelector('#machine2-marker').addEventListener('markerLost', function () {
            console.log('Machine 2 marker lost.');
        });
    </script>
</a-scene>
 
    <script>
    navigator.mediaDevices
            .getUserMedia({
                video: {
                    width: { ideal: 1280 }, // Ideal width
                    height: { ideal: 960 }, // Ideal height
                    facingMode: "environment", // Use rear camera if available
                },
            })
            .then((stream) => {
                const video = document.createElement("video");
                video.srcObject = stream;
                video.play();
                initAR();
            })
            .catch((err) => alert("Permissão de câmera negada:", err));
    </script>
</body>
</html>
 