<!-- 
    TESTANDO APLICAÇÃO COM O GAUGE 
    não ta aparecendo os gauges
    o objetivo é aparecer os gauges
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Main 5</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <script>
        function initAR() {
            const scene = document.querySelector("#a-scene");
            scene.style.display = "block"; 
        }

        AFRAME.registerComponent("maintenance-cursor", {
            init: function () {
                const el = this.el;
                const factText = document.getElementById("fact-text");
                let fact = "";

                fetch("https://cors-anywhere.herokuapp.com/http://numbersapi.com/random/trivia")
                    .then((response) => response.text())
                    .then((data) => {
                        fact = data;
                    })
                    .catch((error) => console.error("Erro ao conectar à API:", error));

                el.addEventListener("click", function () {
                    factText.setAttribute("value", fact);
                });
            },
        });

        AFRAME.registerComponent("status-cursor", {
            init: function () {
                const el = this.el;
                const factText = document.getElementById("fact-text");
                let fact = "";

                fetch("https://cors-anywhere.herokuapp.com/http://numbersapi.com/random/trivia")
                    .then((response) => response.text())
                    .then((data) => {
                        fact = data;
                    })
                    .catch((error) => console.error("Erro ao conectar à API:", error));

                el.addEventListener("click", function () {
                    factText.setAttribute("value", fact);
                });
            },
        });
    </script>

    <style>
        #a-scene {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <a-scene
        id="a-scene"
        embedded arjs="sourceType: webcam; debugUIEnabled: false;"
        camera="position: 0 1.6 0; fov: 80;" init-ar
    >
        <a-entity
            cursor="rayOrigin: mouse;"
            raycaster="objects: .clickable; far: 10; showLine: true"
        ></a-entity>

        <a-box
            id="grandbox"
            position="0 1.25 -3"
            rotation="0 0 0"
            color="#00a335"
            scale="2 1 0.5"
        >
            <a-text
                id="fact-text"
                value=""
                color="white"
                scale="1.8 2 1"
                position="0 0 1"
                align="center"
                width="0.5"
            ></a-text>
        </a-box>

        <a-box
            id="rightbox"
            color="#50788a"
            scale="0.8 0.2 0.3"
            position="0.6 0.5 -3"
            rotation="0 0 0"
            maintenance-cursor
            class="clickable"
            raycaster="objects: .clickable; far: 10; showLine: true"
        ></a-box>

        <a-box
            id="leftbox"
            color="#50788a"
            scale="0.8 0.2 0.3"
            position="-0.6 0.5 -3"
            rotation="0 0 0"
            status-cursor
            class="clickable"
            raycaster="objects: .clickable; far: 10; showLine: true"
        ></a-box>

        <a-text
            value="maintenance"
            color="white"
            width="1.3"
            scale="1.8 1.8 1.8"
            position="0.5 0.7 -2.4"
            align="center"
        ></a-text>
        <a-text
            value="status"
            color="white"
            width="1.3"
            scale="1.8 1.8 1.8"
            position="-0.5 0.7 -2.4"
            align="center"
        ></a-text>

        <a-text 
            value="qtd. produzida" 
            color="white" 
            width="1.3"
            scale="1.3 1.3 1.3" 
            position="0.5 1 -2.4" 
            align="center" 
        >
        </a-text>

        <a-text 
            id="qtdProdNum"
            value="000"            
            color="white" 
            width="1.3"
            scale="1.2 1.2 1.2" 
            position="0.5 0.9 -2.4" 
            align="center" 
        >
        </a-text>  

        <a-text 
            value="qtd" 
            color="white" 
            width="1.3"
            scale="1.3 1.3 1.3" 
            position="0 1 -2.4" 
            align="center" 
        >
        </a-text>

        <a-text 
            value="op" 
            color="white" 
            width="1.3"
            scale="1.3 1.3 1.3" 
            position="-0.5 1 -2.4" 
            align="center" 
        >
        </a-text>
        
        <a-text
            value="INJ000" 
            color="white" 
            width="1.3"
            scale="3 2.9 3" 
            position="0 1.5 -2.4" 
            align="center" 
        >
        </a-text>

        <a-text
            value="producao" 
            color="white" 
            width="1.3"
            scale="2 2 2" 
            position="0 1.4 -2.4" 
            align="center" 
        >
        </a-text>


<!-- GAUGES -->
 
    <a-box 
        id="blackbox" 
        position="0 -0.23 -3"
        rotation="0 0 0"
        color="#000" 
        scale="2.8 1 0.2"
    >
    </a-box>

    <!-- Gauge OEE -->
    <a-entity 
        id="gauge-OEE" 
        position="0 -0.3 -2" 
        scale="1.2 1.2 1.2"
    >
        <a-ring 
            id="ring-OEE" 
            color="blue" 
            radius-inner="0.5" 
            radius-outer="0.6" 
            theta-start="0" 
            theta-length="0"
            position="0 0 -2" 
            scale="1.2 1.2 1.2"    
        ></a-ring>
        <a-text 
            id="text-OEE" 
            value="OEE: 0%" 
            position="-0.6 0.8 0" 
            align="center"
            color="white"
            scale="0.3 0.3 0.3"
        ></a-text>
    </a-entity>

    <!-- Gauge Disponibilidade -->
    <a-entity 
        id="gauge-Disponibilidade" 
        position="0 -0.3 -2" 
        scale="1.2 1.2 1.2"
    >
        <a-ring 
            id="ring-Disponibilidade" 
            color="orange" 
            radius-inner="0.5" 
            radius-outer="0.6" 
            theta-start="0" 
            theta-length="0"
        ></a-ring>
        <a-text
            id="text-Disponibilidade" 
            value="Disp: 0%" 
            position="-0.3 0.8 0" 
            align="center" 
            color="white"
            scale="0.3 0.3 0.3"
        ></a-text>
    </a-entity>

    <!-- Gauge Performance -->
    <a-entity 
        id="gauge-Performance" 
        position="0 -0.3 -2" 
        scale="1.2 1.2 1.2"
    >
        <a-ring 
            id="ring-Performance" 
            color="green" 
            radius-inner="0.5" 
            radius-outer="0.6" 
            theta-start="0" 
            theta-length="0"
        ></a-ring>
        <a-text 
            id="text-Performance" 
            value="Perf: 0%" 
            position="0 0.8 0" 
            align="center" 
            color="white"
            scale="0.3 0.3 0.3"
        ></a-text>
    </a-entity>

    <!-- Gauge Qualidade -->
    <a-entity 
        id="gauge-Qualidade" 
        position="0 -0.3 -2" 
        scale="1.2 1.2 1.2"
    >
        <a-ring 
            id="ring-Qualidade" 
            color="yellow" 
            radius-inner="0.5" 
            radius-outer="0.6" 
            theta-start="0" 
            theta-length="0"
        ></a-ring>
        <a-text 
            id="text-Qualidade" 
            value="Qual: 0%" 
            position="0.3 0.8 0" 
            align="center" 
            color="white"
            scale="0.3 0.3 0.3"
        ></a-text>
    </a-entity>

    </a-scene>

    <script>
navigator.mediaDevices
    .getUserMedia({ video: true })
    .then(() => {
        initAR();      // Inicializa a AR
        initializeGauges(); // Chama a função para inicializar os gauges
    })
    .catch((err) => console.error("Permissão de câmera negada:", err));
    </script>
</body>

<script>
    // Função para inicializar os gauges com valores aleatórios
    function initializeGauges() {
        let oeeValue = getRandomInitialValue();
        let dispValue = getRandomInitialValue();
        let perfValue = getRandomInitialValue();
        let qualValue = getRandomInitialValue();

        // Atualiza os gauges com os valores iniciais
        updateGauge(oeeValue, 'text-OEE', 'ring-OEE');
        updateGauge(dispValue, 'text-Disponibilidade', 'ring-Disponibilidade');
        updateGauge(perfValue, 'text-Performance', 'ring-Performance');
        updateGauge(qualValue, 'text-Qualidade', 'ring-Qualidade');
    }

    // Função para exibir os gauges como um modelo 3D na tela
    function showGauges() {
        const gaugeGroup = document.getElementById('gauge-group');
        gaugeGroup.setAttribute('visible', true);
    }

    // Função para permitir manipulação dos gauges (gestos)
    AFRAME.registerComponent('gesture-handler', {
        schema: {
            enabled: {default: true}
        },
        init: function () {
            this.initialScale = this.el.object3D.scale.clone();
            this.deltaScale = new THREE.Vector3();
            this.initialRotation = this.el.object3D.rotation.clone();
        },
        play: function () {
            this.el.sceneEl.canvas.addEventListener('touchstart', this.onTouchStart.bind(this));
            this.el.sceneEl.canvas.addEventListener('touchmove', this.onTouchMove.bind(this));
        },
        pause: function () {
            this.el.sceneEl.canvas.removeEventListener('touchstart', this.onTouchStart.bind(this));
            this.el.sceneEl.canvas.removeEventListener('touchmove', this.onTouchMove.bind(this));
        },
        onTouchStart: function (event) {
            if (event.touches.length === 2) {
                this.initialDistance = this.getDistance(event.touches[0], event.touches[1]);
                this.initialScale.copy(this.el.object3D.scale);
            } else if (event.touches.length === 1) {
                this.initialX = event.touches[0].pageX;
            }
        },
        onTouchMove: function (event) {
            if (event.touches.length === 2) {
                // Pinch to scale
                const currentDistance = this.getDistance(event.touches[0], event.touches[1]);
                const scaleFactor = currentDistance / this.initialDistance;
                this.el.object3D.scale.copy(this.initialScale).multiplyScalar(scaleFactor);
            } else if (event.touches.length === 1) {
                // Single finger rotate
                const deltaX = event.touches[0].pageX - this.initialX;
                this.el.object3D.rotation.y = this.initialRotation.y + deltaX * 0.01;
            }
        },
        getDistance: function (touch1, touch2) {
            const dx = touch1.pageX - touch2.pageX;
            const dy = touch1.pageY - touch2.pageY;
            return Math.sqrt(dx * dx + dy * dy);
        }
    });

    // Função para atualizar os valores de todos os gauges de forma gradual
    function randomUpdate() {
        let oeeValue = parseInt(document.getElementById('text-OEE').getAttribute('value').split(': ')[1].replace('%', ''));
        let dispValue = parseInt(document.getElementById('text-Disponibilidade').getAttribute('value').split(': ')[1].replace('%', ''));
        let perfValue = parseInt(document.getElementById('text-Performance').getAttribute('value').split(': ')[1].replace('%', ''));
        let qualValue = parseInt(document.getElementById('text-Qualidade').getAttribute('value').split(': ')[1].replace('%', ''));

        oeeValue = getRandomValue(oeeValue);
        dispValue = getRandomValue(dispValue);
        perfValue = getRandomValue(perfValue);
        qualValue = getRandomValue(qualValue);

        updateGauge(oeeValue, 'text-OEE', 'ring-OEE'); updateGauge(dispValue, 'text-Disponibilidade', 'ring-Disponibilidade'); updateGauge(perfValue, 'text-Performance', 'ring-Performance'); updateGauge(qualValue, 'text-Qualidade', 'ring-Qualidade'); } 
</script>

</html>